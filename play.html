<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Play Now • Techy Bechy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { min-height: 100vh; }
    .copy-box {
      cursor: pointer; user-select: all;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    }
    .corner-back { position: fixed; top: 1rem; right: 1rem; }

    /* --- reveal animation --- */
    #ip-cards {
      display: none;           /* hidden until verified */
      opacity: 0;
      transform: translateY(12px);
      transition: opacity .45s ease, transform .45s ease;
      will-change: opacity, transform;
    }
    #ip-cards.revealed {
      opacity: 1;
      transform: translateY(0);
    }
    .reveal-glow { animation: glow .9s ease; }
    @keyframes glow {
      0%   { box-shadow: 0 0 0 rgba(255,255,255,0); }
      40%  { box-shadow: 0 0 24px rgba(255,255,255,.25); }
      100% { box-shadow: 0 0 0 rgba(255,255,255,0); }
    }
  </style>
</head>
<body class="bg-dark text-white">

  <!-- Top-right Go Back -->
  <a href="/" class="btn btn-outline-light corner-back" data-bs-toggle="tooltip" data-bs-title="Go back home">
    ← Go Back
  </a>

  <main class="container py-5">
    <header class="text-center mb-4">
      <h1 class="display-5 fw-bold">Play Now</h1>
      <p class="text-secondary mb-0">Complete the check below to reveal the server addresses.</p>
    </header>

    <!-- Turnstile (visible) -->
    <div class="d-flex justify-content-center mb-3">
      <div id="cfGate" class="cf-challenge"
           data-sitekey="0x4AAAAAABrnFu4lqFjDgydq"
           data-callback="sendToken"
           data-theme="dark"
           data-size="normal"></div>
    </div>

    <!-- Status / error -->
    <div id="verifyMsg" class="text-center text-warning mb-4" style="display:none;"></div>

    <!-- Hidden until verified -->
    <div id="ip-cards">
      <div class="row g-4 justify-content-center">
        <!-- Java -->
        <div class="col-md-6 col-lg-5">
          <div class="card shadow border-0 h-100">
            <div class="card-body text-dark p-4">
              <h2 class="h5 mb-2">Java Edition</h2>
              <p class="mb-3 text-muted">Multiplayer → Add Server → Server Address</p>
              <div class="input-group">
                <span id="javaAddr"
                      class="form-control copy-box"
                      data-copy="mcjva.alberttalkstech.com"
                      data-bs-toggle="tooltip"
                      data-bs-title="Click to copy">
                  mcjva.alberttalkstech.com
                </span>
                <button class="btn btn-primary" onclick="copyFromSpan('javaAddr', this)">Copy</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Bedrock -->
        <div class="col-md-6 col-lg-5">
          <div class="card shadow border-0 h-100">
            <div class="card-body text-dark p-4">
              <h2 class="h5 mb-2">Bedrock Edition</h2>
              <p class="mb-3 text-muted">Play → Servers → Add Server</p>
              <div class="input-group">
                <span id="bedrockAddr"
                      class="form-control copy-box"
                      data-copy="bedrock.alberttalkstech.com"
                      data-bs-toggle="tooltip"
                      data-bs-title="Click to copy">
                  bedrock.alberttalkstech.com
                </span>
                <button class="btn btn-primary" onclick="copyFromSpan('bedrockAddr', this)">Copy</button>
              </div>
              <!-- <small class="text-muted d-block mt-2">Port: 19132</small> -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <noscript>
      <div class="alert alert-warning mt-4">Enable JavaScript to verify and view server addresses.</div>
    </noscript>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
  <script>
    // Enable tooltips
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(el => new bootstrap.Tooltip(el));
    });

    // Click-to-copy
    function copyFromSpan(spanId, btn) {
      const el = document.getElementById(spanId);
      const text = el.getAttribute('data-copy') || el.textContent.trim();
      navigator.clipboard.writeText(text).then(() => {
        const tooltip = bootstrap.Tooltip.getInstance(el);
        if (tooltip) {
          tooltip.setContent({ '.tooltip-inner': 'Copied!' });
          tooltip.show();
          setTimeout(() => tooltip.setContent({ '.tooltip-inner': 'Click to copy' }), 1200);
        }
        if (btn) {
          const old = btn.textContent;
          btn.textContent = 'Copied!';
          setTimeout(() => (btn.textContent = old), 1200);
        }
      });
    }

    // Turnstile callback -> send token to backend
    function sendToken(token) {
      const msg = document.getElementById('verifyMsg');
      msg.style.display = 'none';
      fetch('play.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: 'token=' + encodeURIComponent(token)
      })
      .then(r => r.json())
      .then(data => {
        if (data.success === true) {
          // Hide the Turnstile widget
          const gate = document.getElementById('cfGate');
          if (gate) gate.style.display = 'none';

          // Animate in the cards
          const cards = document.getElementById('ip-cards');
          cards.style.display = 'block';       // reveal in layout
          requestAnimationFrame(() => {        // ensure transition triggers
            cards.classList.add('revealed');
            document.querySelectorAll('#ip-cards .card').forEach(c => c.classList.add('reveal-glow'));
            setTimeout(() => {
              document.querySelectorAll('#ip-cards .card').forEach(c => c.classList.remove('reveal-glow'));
            }, 1000);
          });
        } else {
          msg.textContent = 'Verification failed. Please try again.';
          msg.style.display = 'block';
        }
      })
      .catch(() => {
        msg.textContent = 'Network error verifying challenge. Try again.';
        msg.style.display = 'block';
      });
    }
  </script>
</body>
</html>
